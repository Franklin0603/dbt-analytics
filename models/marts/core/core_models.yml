version: 2

models:
  - name: dim_customers
    description: >
      Customer dimension table containing comprehensive customer information
      including attributes, metrics, and segmentation. This dimension represents
      the single source of truth for customer data and provides a complete view
      of each customer's profile and behavior.
      This is a Type 4 SCD that represents the current state of each customer.
    meta:
      owner: "Analytics Engineering Team"
      layer: "marts"
      business_domain: "core"
      refresh_frequency: "daily"
      dimension_type: "Type 4 SCD"
      primary_business_stakeholder: "Marketing and Sales Teams"
    columns:
      - name: customer_key
        description: "Surrogate key for the customer dimension"
        meta:
          data_type: "varchar(32)"
        tests:
          - not_null
          - unique
      - name: customer_id
        description: "Natural/business key for the customer (original ID from source system)"
        meta:
          data_type: "integer"
        tests:
          - not_null
          - unique
      - name: customer_name
        description: "Full name of the customer"
        tests:
          - not_null
      - name: nation_name
        description: "Name of the nation where the customer is located"
      - name: region_name
        description: "Name of the region where the customer is located"
      - name: market_segment
        description: "Market segment the customer belongs to"
      - name: lifetime_orders
        description: "Total number of orders placed by this customer"
        tests:
          - not_null
      - name: lifetime_revenue
        description: "Total revenue generated by this customer across all orders"
        tests:
          - not_null
      - name: first_order_date
        description: "Date of the customer's first order (acquisition date)"
      - name: most_recent_order_date
        description: "Date of the customer's most recent order"
      - name: days_since_last_order
        description: "Number of days since the customer's last order"
      - name: avg_order_value
        description: "Average order value for this customer"
      - name: lifecycle_stage
        description: "Customer lifecycle stage (New, Active, Loyal, At Risk, Churning, Inactive)"
        tests:
          - accepted_values:
              values: ['New', 'Active', 'Loyal', 'At Risk', 'Churning', 'Inactive', 'Unknown']
      - name: customer_value_tier
        description: "Value tier based on RFM analysis (High Value, Medium Value, Low Value, Very Low Value)"
        tests:
          - accepted_values:
              values: ['High Value', 'Medium Value', 'Low Value', 'Very Low Value']
      - name: business_segment
        description: "Combined business segment based on value and activity status"
      - name: rfm_score
        description: "Combined RFM score (3-15 scale)"
      - name: rfm_segment
        description: "Three-digit RFM segment code combining R, F, and M scores"
      - name: valid_from
        description: "Timestamp from which this customer record is valid"
        tests:
          - not_null
      - name: valid_to
        description: "Timestamp until which this customer record is valid (null for current records)"
      - name: is_current
        description: "Flag indicating if this is the current version of the customer record"
        tests:
          - not_null

  - name: fct_orders
    description: >
      Fact table containing one row per order with all order metrics and attributes.
      Links to dimension tables and contains transaction-level metrics.
    meta:
      owner: "Analytics Engineering Team"
      layer: "marts"
      business_domain: "sales"
      refresh_frequency: "daily"
      fact_type: "transactional"
    columns:
      - name: order_key
        description: "Surrogate key for the order fact"
        meta:
          data_type: "varchar(32)"
        tests:
          - unique
          - not_null
      - name: order_id
        description: "Natural/business key for the order (original ID from source system)"
        meta:
          data_type: "integer"
        tests:
          - unique
          - not_null
      - name: customer_key
        description: "Foreign key to the customer dimension"
        meta:
          data_type: "varchar(32)"
        tests:
          - not_null
          - relationships:
              to: ref('dim_customers')
              field: customer_key
      - name: order_date
        description: "Date when the order was placed"
        tests:
          - not_null
      - name: total_final_price
        description: "Total price of the order after discounts and taxes"
        tests:
          - not_null
      - name: days_to_first_shipment
        description: "Number of days between order date and the first shipment"
      - name: on_time_shipping_rate
        description: "Percentage of line items in this order that were shipped on time"
      - name: is_fully_shipped_on_time
        description: "Boolean flag indicating if all items in the order were shipped on time"