version 2: 

models:
  - name: int_tpch_customer_profile 
    description: > 
      Customer profile model that combines customer attributes with
      geographic information and derived attributes. This model serves
      as the foundation for customer analysis and enriches the raw
      customer data with useful categorizations.
    meta:
      owner: "Analytics Engineering Team"
      layer: "intermediate"
      business_domain: "customer"
    columns: 
      - name: customer_id 
        description: "Unique identifier for the customer"
        tests: 
          - not_null 
          - unique 
      - name: customer_name 
        description: "Full name of the customer"
        tests: 
          - not_null 
      - name: nation_id 
        description: "Foreign key to nation dimension"
      - name: nation_name
        description: "Name of the nation where the customer is located"
      - name: region_id
        description: "Foreign key to region dimension"
      - name: region_name
        description: "Name of the region where the customer is located"
      - name: phone_area_code
        description: "Area code extracted from the customer's phone number"
      - name: balance_tier
        description: "Classification of the customer's account balance (negative, zero, low, medium, high)"
        tests:
          - accepted_values:
              values: ['negative', 'zero', 'low', 'medium', 'high']
      - name: dbt_updated_at
        description: "Timestamp of when this record was last updated"

  - name: int_tpch__customer_orders
    description: >
      Customer order metrics model that aggregates order and line item data
      at the customer level. This model includes detailed order behavior
      metrics across different time windows and provides insights into
      customer purchasing patterns.
    meta:
      owner: "Analytics Engineering Team"
      layer: "intermediate"
      business_domain: "customer"
    columns:
      - name: customer_id
        description: "Unique identifier for the customer"
        tests:
          - not_null
          - unique
      - name: total_orders
        description: "Total number of orders placed by the customer"
      - name: orders_last_year
        description: "Number of orders placed in the last 12 months"
      - name: orders_last_3_months
        description: "Number of orders placed in the last 3 months"
      - name: orders_last_month
        description: "Number of orders placed in the last month"
      - name: first_order_date
        description: "Date of the customer's first order"
      - name: most_recent_order_date
        description: "Date of the customer's most recent order"
      - name: days_since_last_order
        description: "Number of days since the customer's most recent order"
      - name: avg_days_between_orders
        description: "Average number of days between the customer's orders"
      - name: total_revenue
        description: "Total lifetime revenue generated by the customer"
      - name: revenue_last_year
        description: "Revenue generated in the last 12 months"
      - name: avg_order_value
        description: "Average value of the customer's orders"
      - name: avg_on_time_shipping_rate
        description: "Average percentage of on-time shipments for the customer's orders"
      - name: fulfilled_order_ratio
        description: "Percentage of the customer's orders that have been fulfilled"
      - name: dbt_updated_at
        description: "Timestamp of when this record was last updated"

  - name: int_tpch__customer_segments
    description: >
      Customer segmentation model that categorizes customers across multiple
      dimensions based on their behavior and value. This model enables
      targeted marketing, personalized communications, and differentiated
      service strategies.
    meta:
      owner: "Analytics Engineering Team"
      layer: "intermediate"
      business_domain: "customer"
    columns:
      - name: customer_id
        description: "Unique identifier for the customer"
        tests:
          - not_null
          - unique
      - name: recency_score
        description: "RFM recency score from 1-5 (5 = most recent purchase)"
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: frequency_score
        description: "RFM frequency score from 1-5 (5 = most frequent purchaser)"
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: monetary_score
        description: "RFM monetary score from 1-5 (5 = highest spend)"
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: rfm_score
        description: "Combined RFM score (3-15)"
      - name: rfm_segment
        description: "Three-digit RFM segment code combining R, F, and M scores"
      - name: lifecycle_stage
        description: "Customer lifecycle stage based on order history and recency"
        tests:
          - accepted_values:
              values: ['New', 'Active', 'Loyal', 'At Risk', 'Churning', 'Inactive', 'Unknown']
      - name: purchase_frequency_segment
        description: "Segmentation based on order frequency in last 12 months"
        tests:
          - accepted_values:
              values: ['Inactive', 'One-time', 'Occasional', 'Regular', 'Frequent', 'Unknown']
      - name: aov_segment
        description: "Segmentation based on average order value"
        tests:
          - accepted_values:
              values: ['Low AOV', 'Medium AOV', 'High AOV', 'Very High AOV', 'Unknown']
      - name: customer_value_tier
        description: "Customer value classification based on RFM score"
        tests:
          - accepted_values:
              values: ['High Value', 'Medium Value', 'Low Value', 'Very Low Value']
      - name: business_segment
        description: "Combined business segment for targeting and personalization"
      - name: dbt_updated_at
        description: "Timestamp of when this record was last updated"
